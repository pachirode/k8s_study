`cgroup` 是 `Linux` 内核提供的一种资源管理和限制机制，主要用于对进程进行分组，并对分组内的进程进行资源限制，优先级调整等功能
提供一种统一的接口用来管理系统资源，比如 `CPU`、内存、IO、网络等资源，并管理这些资源的使用情况。

- `cgroup` 文件系统
    - 用来存储 `cgroup` 的配置信息和状态数据
- 子系统
    - 用来实现对特定资源的管理和限制
    - 一个子系统就代表一个资源控制器
- 控制组
    - 对进程进行分组，每个控制组可以关联一个或者多个子系统
- 层级
    - 控制组可以进行嵌套，子节点控制组会继承父节点资源的限制规则

`cgroup` 和 `namespace` 类似，但是主要作用不一样

- `cgroup` 对一组进程进行统一的资源管理
- `namespace` 是为了隔离进程组之间的资源

# 查看现有的资源隔离

常用的为 `CPU`, `Memory`, `blkio` (`I/O` 块设备)

```bash
ls /sys/fs/cgroup/ -al
```

# 系统资源

通过将 `cgroup` 和 `systemd` 单位树捆绑，可以把资源管理设置从进程级别移动至应用级别
默认 `systemd` 会自动创建 `slice` `scope` 和 `service` 单位层级

### CPU 资源划分

- 三个默认的顶级 `slice`
    - 三个 `cgroup`
        - `System`
            - 所有系统 `service` 的默认位置
        - `User`
            - 所有用户会话的默认位置
            - 每个用户会话都会在该 `slice` 下创建一个子 `slice`，如果同一个用户多次登录，会使用相同的子 `slice`
        - `Machine`
            - 所有虚拟机和 `Linux` 容器的默认位置
    - 每个 `slice` 都会获得相同的 `CPU` 使用时间，在 `CPU` 繁忙的时候
- `shares`
  - 设置 `CPU` 权重，针对每个控制组，默认为 `1024`
- 设置 `CPU` 资源限制
  - `cpu.cfs_period_us`
    - 统计 `CPU` 使用时间的周期，单位是微秒
  - `cpu.cfs_quota_us`
    - 周期内允许占用的 `CPU` 时间（单核时间，多核需要累加）


