# QoS

服务质量等级，保障 `k8s` 集群资源的高效利用
`k8s` 会根据容器的资源配置自动为 `Pod` 分配 `QoS` 等级
除了影响调度，同时还决定了资源的回收顺序

### 等级

- `Guaranteed`
    - 每个容器都设置 `limits` 和 `requests`，且值相等
    - 用于关键业务
- `Burstable`
    - 至少有一个容器设置了，并且值不完全相等
    - 一般业务，开发测试
- `BestEffort`
    - 所有容器都未设置
    - 非关键，批处理任务

##### Guaranteed

保证级，优先级最高，优先获取充分的资源

```yaml
spec:
  containers:
    - name: app
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 100m
          memory: 128Mi
```

##### Burstable

突发级，满足部分基本资源之后调度

##### BestEffort

尽力而为

# 控制器

集群中的核心组件，负责监控集群的实际状态并使其向期望的状态收敛
每个控制器都可以看作一个状态机，通过控制循环来管理和调节 `Pod` 及其他资源的生命周期

- 状态监控
    - 持续监控资源的当前状态
- 差异检测
    - 比较当前状态和期望状态的差异
- 状态调节
    - 执行必要的操作以消除状态差异
- 事件响应
    - 对集群中的事件做出对应反应

### 基本模式

- 通过 `API Server` 监听相关资源变化
- 分析当前状态和期望状态的差异
- 采用行动来修正差异
- 持续上述步骤
