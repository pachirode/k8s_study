# 垃圾回收机制

为了保证节点资源充足，`kubelet` 提供了 `Pod` 驱逐和垃圾回收机制来保证节点资源不被耗尽

- 节点资源不足时，会根据 `Qos` 优先级驱逐 `Pod`
- 清理不需要的容器和镜像

### 配置

使用两个 `goroutine` 实现垃圾回收功能

`kubelet` 默认开启垃圾回收功能，对容器进行垃圾回收的频率为每分钟一次，对镜像为五分钟一次

### 触发点

- 正常触发
    - 定时执行
- 强制触发
    - 节点资源不足

### 容器回收流程

- 清理可驱除的容器
- 清理可驱除的 `sandbox`
- 清理所有 `pod` 的日志目录

### 镜像回收流程

- 获取 `kubelet` 磁盘状态
- 计算磁盘总量和可用容量的使用百分比
- 如果使用率超过阈值就会执行垃圾回收
- 根据参数和当前使用率计算需要的空间
- 执行垃圾回收直到有充足的资源