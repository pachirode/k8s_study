# kube-controller-manager

`Kubernetes` 是主控制节点上的关键组件，负责核心控制循环，这些控制循环主要用来控制集群范围内的各个功能
主要用来监听 `API Server` 的变化来触发相应的控制器逻辑，从而实现对整个集群的管理和自动化操作

### 启动

- 启动事件记录器
  - 开始以结构化的格式记录事件
  - 启动事件录制，将事件发送到 `API`，`Event` 接口
- 创建两个 `ClientBuilder`
  - `rootClientBuilder`
    - 提供一种基础的方式创建具有根权限的 `Kubernetes` 客户端
  - `clientBuilder`
    - 根据是否启用服务账户凭证
      - 启用，尝试使用服务账户的身份进行安全操作
      - 没有启用，直接复用 `rootClientBuilder`
- 定义一个 `run` 方法
  - 创建一个控制器上下文，控制器上下文包括控制器启动需要的各种信息
  - 基于该控制器上下文以及 `controllerDescriptors` 变量来启动注册控制器
- 创建控制器集合
  - 获取需要启动的控制器列表
    - `key` 控制器名称
    - `value` 控制器核心参数
- 注册控制器
- 启动控制器
  - 控制器上下文和控制器集合之后，启动控制器
  - 检查控制器通过 `FeatureGate` 开启，如果禁止启动，跳过该控制器
  - 是否为云提供商控制器，是则跳过
  - 判断控制器是否需要开启
  - 等待一小段时间，在启动控制器，减少 `kube-apiserver` 压力
  - 初始化控制器
- 启动 `Informer`
  - 上面创建共享和元数据 `informer`，此处使用代码启动
- 开启领导选举