# 控制面

控制器会 `Watch` 特定资源的变更，并根据资源变更，进行调和处理，使资源始终处在期望状态

### 自定义控制器

可以使用 `kubebuilder` 或者 `sigs.k8s.io/controller-runtime`，基于 `sample-controller` 修改

### CPI 扩展

### 调度器扩展

运行 `Pod` 时，需要根据一系列算法，将 `Pod` 调度到合适的 `Worker`

##### 扩展方式

- 修改 `kube-scheduler`
    - 不易维护
- 自定义调度器，替换 `kube-scheduler`
- 多调度器
    - 可能产生调度冲突，一个资源以及被实际使用，其他调度器去绑定资源
- `extended scheduler`
    - 推荐使用 `sheduler-plugin` 替代
- `scheduling Framework`

### KMS

之前向 `Etcd` 中存储数据时，都是明文保存的，`Secret` 资源为了安全，需要加密保存
使用 `KMS` 扩展机制，支持以加密的形式存储数据或者对接外部的 `Key Management` 管理系统

##### 流程

- 插件实现
    - 开发一个符合 `KMS` 规范的插件，该插件负责与特定的密钥管理系统进行交互
- `k8s` 配置
    - 在 `k8s` 集群中配置 `KMS` 插件，使得能给被其他组件使用
- 密钥请求
    - 需要加密或者解密时，会调用 `KMS` 插件
- 状态更新
    - 返回密钥，更新密钥状态